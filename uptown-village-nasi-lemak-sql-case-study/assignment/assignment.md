# üìù Assignment 


### 8. Which customer used all 3 order channels?

- **Step 1:** Select `customer_id` from `uptown_nasi_lemak.orders`.
- **Step 2:** Use `COUNT(DISTINCT channel_id) = 3` in `HAVING`.
- **Step 3:** Filter results where the count = 3.

<details> 
<summary> ‚ñ∂Ô∏è Show solution</summary>

```sql
SELECT COUNT(customer_id)
FROM uptown_nasi_lemak.orders
HAVING COUNT(DISTINCT channel_id) = 3;
```

‚úÖ Expected result:
| **count** |
|-----------|
| 297       |

</details>


What is the total revenue generated by each order channel (Dine-In, Takeaway, GrabFood)?
Which menu item had the highest number of total orders?
Which customers have used more than one order channel?
For each menu item, which order channel was the most frequently used?
What is the average spend per order for each order channel?
How much revenue did the restaurant make per day?
Which customers spent more than RM50 in total?
Which customers placed the most total orders?
What percentage of total orders came through GrabFood?
On each date, show the number of orders placed via each channel.

<details> 
<summary> ‚ñ∂Ô∏è Show solution üí° (click to expand) </summary>

```sql
SELECT COUNT(*) AS no_of_total_orders
FROM uptown_nasi_lemak.sales;
```

‚úÖ Expected result: 36

</details>

Difficulty: üü° Intermediate (Level 4)
1. Total Revenue by Channel
What is the total revenue generated by each order channel (Dine-In, Takeaway, GrabFood)? Display the channel name with total revenue in descending order.
Skills: JOIN, GROUP BY

SELECT
  	channels.channel_name,
    SUM(menu.price) AS total_revenue
FROM uptown_nasi_lemak.sales AS sales
INNER JOIN uptown_nasi_lemak.menu AS menu
	ON sales.food_id = menu.food_id
INNER JOIN uptown_nasi_lemak.order_channels AS channels
	ON sales.channel_id = channels.channel_id
GROUP BY channels.channel_name
ORDER BY total_revenue DESC;



Why this works:
* INNER JOIN ensures you only get valid combinations where the product_id and channel_id exist.
* You‚Äôre grouping by channel_name and summing the price of each dish sold per channel ‚Äî exactly what the question asks.

Difficulty: üü° Intermediate (Level 4)
2. Top-Selling Dish
Which menu item had the highest number of total orders? Display the food name with number of total orders.
Skills: GROUP BY, ORDER BY, COUNT

SELECT
	menu.food_name,
    count(*) AS total_orders
FROM uptown_nasi_lemak.sales AS sales
INNER JOIN uptown_nasi_lemak.menu AS menu
	ON sales.food_id = menu.food_id
GROUP BY menu.food_name
ORDER BY total_orders DESC
LIMIT 1;

‚úÖ Breakdown of why it's good:
* INNER JOIN ensures you link sales to menu by food_id ‚úîÔ∏è
* COUNT(customer_id) works because each row = 1 item ordered ‚úîÔ∏è
* GROUP BY menu.food_name lets you aggregate by dish ‚úîÔ∏è
* ORDER BY total_orders DESC LIMIT 1 returns the top-selling item ‚úîÔ∏è

Difficulty: üü° Intermediate (Level 5)
3. Multi-Channel Customers
Which customers have used more than two order channels?
Skills: GROUP BY, COUNT(DISTINCT), HAVING

SELECT
	customer_id,
    COUNT(DISTINCT channel_id) AS channel_count
FROM uptown_nasi_lemak.sales
GROUP BY customer_id
HAVING COUNT(DISTINCT channel_id) > 2
ORDER BY customer_id
;

COUNT(DISTINCT channels.channel_id) ensures you‚Äôre counting unique channels per customer
HAVING > 2 filters only those who used more than 2 channels (i.e. all 3)
ORDER BY sales.customer_id gives alphabetical output

Difficulty: üî¥ Challenging (Level 7)
Challenge: Finding the Top Category per Group (with Ties)"
üß† Level 6 ‚Äì Window Functions + Group Ranking
4. Most Popular Channel per Dish
For each menu item, which order channel was the most frequently used?
Skills: GROUP BY, subqueries or window functions

WITH frequently_used_channels_cte AS (
SELECT
    menu.food_name,
    channels.channel_name,
    COUNT(*) AS channel_count,
  	DENSE_RANK() OVER (
      	PARTITION BY menu.food_name 
      	ORDER BY COUNT(*) DESC) AS dense_rank_ranking
Is
GROUP BY menu.food_name,channels.channel_name
-- ORDER BY food_name, dense_rank_ranking
)

SELECT
	food_name,
    channel_name,
    channel_count
FROM frequently_used_channels_cte
WHERE dense_rank_ranking = 1;


5. Average Spend per Channel
Difficulty: üü† Advanced (Level 6)
What is the average spend per order for each order channel?
Skills: JOIN, GROUP BY, AVG, SUM

SELECT 
    channels.channel_name,
    SUM(menu.price)/COUNT(sales.order_date) AS avg_spend_per_order
FROM uptown_nasi_lemak.sales AS sales
INNER JOIN uptown_nasi_lemak.menu AS menu
	ON sales.food_id = menu.food_id
INNER JOIN uptown_nasi_lemak.order_channels AS channels
	ON sales.channel_id = channels.channel_id
GROUP BYchannels.channel_name;

This gives you the true average revenue per sale row ‚Äî which, assuming each row = one item in one order, works fine for your dataset.

What You're Trying to Calculate
You're asking:
What is the average spend per order for each channel?
So you want:
rust
CopyEdit
total revenue for that channel √∑ total number of orders via that channel

üîç Why AVG(menu.price) Might Be Misleading
AVG(menu.price) averages the menu price per row, regardless of how many items were in the order. But:
* If a customer ordered 2 items in 1 order, that counts as 2 rows ‚Äî so the average gets skewed.
* SQL doesn‚Äôt group by order_id, because your data doesn't track orders that way ‚Äî only rows of individual items.
So, AVG(menu.price) is calculating average price per item, not per order.


6. Daily Revenue Trend
Difficulty: üü° Intermediate (Level 4)
How much revenue did the restaurant make per day? Display order date and total revenue by ascending order of date.
Skills: GROUP BY order_date, JOIN

SELECT 
    sales.order_date,
    SUM(menu.price) AS total_revenue
FROM uptown_nasi_lemak.sales AS sales
INNER JOIN uptown_nasi_lemak.menu AS menu
	ON sales.food_id = menu.food_id
GROUP BY sales.order_date
ORDER BY sales.order_date;

7. High-Spending Customers
Difficulty: üü° Intermediate (Level 5)
Which customers spent more than RM50 in total?
Skills: SUM, GROUP BY, HAVING

SELECT 
    sales.customer_id,
    SUM(menu.price) AS total_spent
FROM uptown_nasi_lemak.sales AS sales
INNER JOIN uptown_nasi_lemak.menu AS menu
	ON sales.food_id = menu.food_id
GROUP BY sales.customer_id
HAVING SUM(menu.price) > 50
ORDER BY total_spent DESC;

You're joining the sales and menu tables to get price info ‚úÖ
Grouping by customer_id ‚úÖ
Summing total spend per customer ‚úÖ
Using HAVING to filter only those spending more than RM50 ‚úÖ
Sorting from highest spender to lowest ‚úÖ


8. Most Frequent Customers
Difficulty: üü° Intermediate (Level 4)
Which customers placed the most total orders? Display the customer ID with total count of orders
Skills: COUNT, GROUP BY, ORDER BY

SELECT
	customer_id,
	COUNT(order_id) AS total_orders
FROM uptown_nasi_lemak.sales
GROUP BY customer_id
ORDER BY total_orders DESC
LIMIT 1;

How would you modify the query to return all customers who placed the most orders, in case of a tie?

WITH most_orders_cte AS (
SELECT
	customer_id,
	COUNT(order_id) AS total_orders
FROM uptown_nasi_lemak.sales
GROUP BY customer_id
)

SELECT *
FROM most_orders_cte
WHERE total_orders = 
	(SELECT MAX(total_orders) FROM most_orders_cte)

9. GrabFood Popularity
Difficulty: üü† Advanced (Level 6)
What percentage of total orders came through GrabFood?
Skills: COUNT, JOIN, filtering, percentage calculation

SELECT 
	ROUND(
    	100.0*SUM(CASE WHEN channels.channel_name = 'GrabFood' THEN 1 ELSE 0 END)
      	/COUNT(*),2) AS grabfood_percentage
FROM uptown_nasi_lemak.sales AS sales
INNER JOIN uptown_nasi_lemak.order_channels AS channels
	ON sales.channel_id = channels.channel_id;

10. Channel Mix by Day
Difficulty: üü° Intermediate (Level 5)
On each date, show the number of orders placed via each channel.
Skills: GROUP BY multiple columns, JOIN

SELECT
	sales.order_date,
    channels.channel_name,
   	COUNT(sales.order_id) AS order_number
FROM uptown_nasi_lemak.sales AS sales
INNER JOIN uptown_nasi_lemak.order_channels AS channels
	ON sales.channel_id = channels.channel_id
GROUP BY
	sales.order_date,
    channels.channel_name
ORDER BY sales.order_date, channels.channel_name


